<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="zh" xml:lang="zh">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<link rel="stylesheet" type="text/css" href="learn-vi.css" />
	<title>VIM学习笔记  脚本-变量和常量 (Script-Variables and Constants)</title>
</head>
<body>
	<p>使用脚本语言，可以更灵活地定制编辑器以完成复杂的任务。</p>

	<p style="font-weight:bold; border-bottom:1px solid lightgray; border-left:6px solid lightgray; padding:0 0 3px 5px">:echo命令</p>
	<p>:echo可以显示命令中的参数。</p>
	<p><code class="inset">:echo "Hello world"</code></p>
	<p>以上命令的执行结果如下：</p>
	<p><code class="msg">Hello world</code></p>
	<p>:echo还可以显示变量的值。</p>
	<p><code class="inset">:let flag=1<br />:echo flag</code></p>
	<p>以上命令的执行结果如下：</p>
	<p><code class="msg">1</code></p>
	<p>使用|可以分隔同一行中的两个命令。</p>
	<p><code class="inset">:echo "aa" | echo "bb"</code></p>
	<p>以上命令的执行结果如下：</p>
	<p><code class="msg">aa<br />bb</code></p>
	<p>:echon也只显示命令中的参数，但不会输出新行。</p>
	<p><code class="inset">:echon "aa" | echon "bb"</code></p>
	<p><code class="msg">aabb</code></p>

	<p>可以通过:echohl命令，使用指定高亮颜色组输出信息。</p>
	<p><code class="inset">:echohl ErrorMsg<br />:echo "A mistake has been make"</code></p>
	<p><code class="error">A mistake has been make</code></p>
	<p>为了不影响后续:echo命令的显示效果，建议使用以下命令重设高亮显示为None：</p>
	<p><code class="inset">:echohl None</code></p>
	<p>使用以下命令，可以查看<a href="http://bit.ly/vim-syntaxHL" title="Syntax Highlight">高亮显示组</a>的颜色定义：</p>
	<p><code class="inset">:highlight</code></p>
	

<p>在:echo命令中，可以使用以下转义符：</p>
<ul>
	<li><code class="inset">\n</code>&nbsp;Newline</li>
	<li><code class="inset">\r</code>&nbsp;Carriage return</li>
	<li><code class="inset">\t</code>&nbsp;Tab</li>
	<li><code class="inset">\123</code>&nbsp;八进制数字</li>
	<li><code class="inset">\x123</code>&nbsp;十六进制数字</li>
	<li><code class="inset">\u01fc34</code>&nbsp;Unicode</li>
	<li><code class="inset">\f</code>&nbsp;Form feed</li>
	<li><code class="inset">\e</code>&nbsp;Esc</li>
	<li><code class="inset">\b</code>&nbsp;Backspace</li>
	<li><code class="inset">\\</code>&nbsp;反斜线</li>
	<li><code class="inset"></code>&nbsp;</li>
</ul>

	<p style="font-weight:bold; border-bottom:1px solid lightgray; border-left:6px solid lightgray; padding:0 0 3px 5px">判断</p>
	<p>if语句的一般形式如下：</p>
	<p><script src="https://gist.github.com/yyq123/37f94883a1073534ded1cba1ad1b0831.js"></script></p>
	<p>只有条件(condition)为真时，if语句块内的语句才会被执行。</p>
	<p>if语句还可以包含else子句：</p>
	<p><script src="https://gist.github.com/yyq123/4745a7c937e2f50ea3cdf7a97b43d5dc.js"></script></p>
	<p>满足条件(condition)时，if语句块内的语句将会被执行；而不满足条件(condition)时，则else语句块内的语句将会被执行。</p>
	<p>if-else结构还可以进行多重判断</p>
	<p><script src="https://gist.github.com/yyq123/1ef507645718969cab35add75ef04e90.js"></script></p>

	<p style="font-weight:bold; border-bottom:1px solid lightgray; border-left:6px solid lightgray; padding:0 0 3px 5px">循环</p>
	<p>while命令开始一个循环，并由endwhile命令结束。在条件为真是，循环中的代码将被重复执行。</p>
	<p><script src="https://gist.github.com/yyq123/f87f86115272d5a9a0ab24682d03d1cc.js"></script></p>
	<p>continue命令回到程序的顶部开始执行下一次循环；而break命令则立刻退出循环。</p>
	<p><script src="https://gist.github.com/yyq123/54235dab1797017f16ae38a654c0fe4a.js"></script></p>

	<p style="font-weight:bold; border-bottom:1px solid lightgray; border-left:6px solid lightgray; padding:0 0 3px 5px">:execute命令</p>
	<p>:execute将执行参数中指定的命令：</p>
	<p><code class="inset">:let  command = " echo 'Hello world!'"<br />
	:execute command
	</code></p>
	<p><code class="msg">Hello world</code></p>


	<p style="font-weight:bold; border-bottom:1px solid lightgray; border-left:6px solid lightgray; padding:0 0 3px 5px">函数</p>
	<p>Vim编辑器还允许我们定义自己的函数.函数定义的一般形式如下:</p>
	<p><script src="https://gist.github.com/yyq123/8ccf228e869fb644f395e1756095de3d.js"></script></p>
	<p><em>Name</em>，函数名称必须以大写字母开始，并且只可以包含字母、数字和下划线。</p>
	<p><em>arg1-argN</em>，调用函数时需要被赋值的参数。如果不需要任何参数，那么可以将括号()部分置空。最多可以定义20个参数。</p>
	<p><em>keyword</em>，range关键字定义一个范围函数，当在一个范围的行内运行这个程序时,变量a:firstline,a:lastline就会设置成为这个范围内的第一行和最后一行；abort关键字指示函数会在第一个错误时退出。</p>
	<p>下面我们来定义一个小函数,用这个函数来返回两个数中较小的一个</p>
	<p><script src="https://gist.github.com/yyq123/4c18997ffac9a857d6d0f0b452923df4.js"></script></p>
	<p>函数内部的变量（例如smaller）均为局部变量，除非使用了g:作为前缀。例如在函数外我们定义了变量var，那么在函数内部可以使用g:var来调用。前缀a:的变量均为函数参数。</p>
	<p>return语句用于返回结果并结束函数。return语句之后的所有代码都不会被执行。</p>
	<p>可以在表达式中调用函数：</p>
	<p style="text-indent:2em"><code class="inset">:let tiny = Min(10,20)</code></p>
	
我们还可以用:call命令用函数名来显示调用函数功能:
:[range]call {function}([parameters])
如果指定了[range]则每一行都要调用函数,除非这个函数是一特殊的range风格函数.
<p>如果我们尝试定义一个已经存在的函数，那么就会得到一个错误信息。我们可以使用!来强制替换之前定义的同名函数。</p>


<p>Vim允许在函数中使用&ldquo;...&rdquo;标识个数不定的参数。例如以下代码定义函数至少有2个参数，最多有20个参数：</p>
<p><script src="https://gist.github.com/yyq123/ff3e8bc64a9bcf9f3745602da5a9aba9.js"></script></p>
<p><em>argnum</em> 计数器，用于记录num1和num2之后的参数个数；</p>
<p><em>a:0</em> 变量，用于记录参数总个数；</p>
<p><em>a:{argnum}</em> 变量，用于访问每一个参数的值；</p>

<p>使用以下命令，可以列出所有用户定义的函数：</p>
<p style="text-indent:2em"><code class="inset">:function</code></p>
<p>使用以下命令，可以查看指定函数的代码：</p>
<p style="text-indent:2em"><code class="inset">:function {name}</code></p>
<p>使用以下命令，可以删除指定的函数：</p>
<p style="text-indent:2em"><code class="inset">:delfunction {name}</code></p>

<p>使用以下命令，可以查看关于函数的更多帮助信息：</p>
<p style="text-indent:2em"><code class="inset">:help function-list</code></p>

	<p style="font-weight:bold; border-bottom:1px solid lightgray; border-left:6px solid lightgray; padding:0 0 3px 5px">命令</p>
Vim编辑器允许我们定义自己的命令.我们可以像执行其他的命令模式的命令一样来执行我们自己定义的命令.要定义一个命令我们要使用:command命令,例如:
:command Delete_first :1delete
这样当我们执行命令:Delete_first Vim就会执行:1delete,从而删除第一行.
如果我们要列出用户定义的命令,我们可以用下面的命令:
:command
要删除用户定义的命令,我们可以用下面的命令:
:delcommand
例如:
:delcommand Delete_one
我们还可以用下面的命令来清除所有的用户定义的命令:
:comclear
用户定义的命令可以指定一系列的参数.参数的个数要由-nargs选项在命令行中指定.例如,Delete_one命令没有参数,我们可以像下面的样子来定义:
:command Delete_one -nargs=0 1delete
然而因为在默认的情况下-nargs=0,所以我们不需要指定他.
其他的-nargs选项值如下:
-nargs=0    没以参数
-nargs=1    1个参数
-nargs=*    任何个数的参数
-nargs=?    零个或是一个参数
-nargs=+    一个或是更多个参数
在命令的定义中,参数是由关键字<args>指定的.例如:
:command -nargs=+ Say :echo "<args>"
然后我们输入:
:Say Hello World
命令的执行结果为:
Hello World
一些命令是指定一个范围作为其参数.告诉Vim我们在定义这样的一个命令我们需要指定-range选项.选项的值如下:
-range    允许的范围,默认为当前行.
-range=%    允许的范围,默认为当前文件(while file)
-range=count    允许的范围,但是他只是一个单一的数字,默认下为count.
当我们指定了一个范围以后,我们就可以用关键字<line1>和<line2>得到这个范围的第一行和最后一行.
例如下面的命令定义了一个SaveIt命令,这个命令可以将指定范围的文件写入文件save_file:
:command -range=% SaveIt:<line1>,<line2> write! save_file
其他的一些选项和关键字如下:
-count=number
这个命令指定一个数量,默认为number.数量的结果保存在关键字<count>中.
-bang    我们可以使用!修饰符.如果指定了,!将会被存放在关键字<bang>中.
-register
我们可以指定一个寄存器,默认为未命名寄存器.寄存器的定义放在关键字<reg>中.
关键字<f-args>含有与关键字<args>相同的信息.所不同的只是函数的调用方式不同.例如:
:command -nargs=* DoIt :call AFunction(<f-args>)
:DoIt a b c 
执行下面的命令:
:call AFunction("a","b","c")
最后我们还有<lt>关键字,他包含字符<.

	<p style="font-weight:bold; border-bottom:1px solid lightgray; border-left:6px solid lightgray; padding:0 0 3px 5px">脚本文件架构</p>
	<p>文件头（Header）：脚本的描述，作者，版本，最近更新日期，授权方式等。以"开头为注释。</p>
	<p>脚本载入检查（Script-Loaded Check）：检查脚本是否已经被载入，如果已经载入，那么应该首先卸载，然后再执行后续功能；检查是否使用vi兼容模式。</p>
	<p style="text-indent:2em"><code class="inset"></code></p>
	<p><script src="https://gist.github.com/yyq123/6e11fad7cbc540f972cf5b0044302725.js"></script></p>
	<p><code class="inset">:help 'write-filetype-plugin'<br />
	:help 'write-compiler-plugin'<br />
	:help 'write-library-script'<br /></code></p>
	<table summary="Commands" border="2" frame="hsides" rules="all" cellspacing="0" cellpadding="3">
		<caption>命令小结</caption>
		<tr><td><code class="inset">:</code></td><td rowspan="2"></td></tr>
		<tr><td><code class="inset">:</code></td></tr>
		<tr><td><code class="inset">:</code></td><td></td></tr>
		<tr><td><code class="inset">:</code></td><td></td></tr>
		<tr><td><code class="inset">:</code></td><td></td></tr>
	</table>

	<p style="border-top:1px solid lightgray"><span style="float:right">Ver: 1.0</span><span>&lt;<a title="()" href="">上一篇</a>&nbsp;|<a title="笔记列表" href="http://yyq123.github.com/learn-vim/learn-vi-00-List.html">&nbsp;目录&nbsp;</a>|&nbsp;<a title="()" href="">下一篇</a>&gt;</span></p>
</body>
</html>

