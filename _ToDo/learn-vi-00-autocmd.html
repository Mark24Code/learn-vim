<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="zh" xml:lang="zh">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<link rel="stylesheet" type="text/css" href="learn-vi.css" />
	<title>VIM学习笔记 自动命令(autocmd)</title>
</head>
<body>
	<h1>VIM学习笔记 自动命令(autocmd)</h1>

	<p>自动命令，是可以在指定事件发生时自动执行的命令。可以将重复的手工操作自动化，以提高编辑效率并减少人为操作的差错。</p>
	<p>比如自定义以下函数，用于在保存文件时插入当前日期：</p>
<pre><code>
:function DateInsert()
:    $read !date
:endfunction
</code></pre>
	<p>使用以下命令，可以手动调用此函数：</p>
	<p style="text-indent:2em"><code class="inset">:call DateInsert()</code></p>
	<p>通过以下自动命令，则可以在保存文件时自动执行函数，而不再需要额外的手动操作：</p>
	<p style="text-indent:2em"><code class="inset">:autocmd FileWritePre * :callDateInsert()<CR></code></p>

	<h2 class="article"><a id="">定义自动命令</a></h2>
	<p>可以使用以下格式的autocmd命令，来定义自动命令：</p>
	<p style="text-indent:2em"><code class="inset">:autocmd [group] events pattern [nested] command</code></p>
	<ul>
		<li><em>group</em>，组名是可选项，用于分组管理多条自动命令；</li>
		<li><em>events</em>，事件参数，用于指明引发命令的一个或多个事件；</li>
		<li><em>pattern</em>，在符合匹配模式的文件中执行命令（*任意文件）；</li>
		<li><em>nested</em>，嵌套标记是可选项，用于允许嵌套自动命令；</li>
		<li><em>command</em>，指明需要执行的命令、<a href="http://yyq123.github.io/learn-vim/learn-vi-93-ScriptUDF.html" title="Script-User Defined Function">函数</a>或脚本。</li>
	</ul>

	<p style="font-weight:bold">events参数</p>
	<table summary="Commands" border="1" frame="border" rules="all" cellspacing="0" cellpadding="3">
		<tr><td><code class="inset"></code></td><td></td></tr>
		<tr><td><code class="inset">EncodingChanged</code></td><td>'encoding'选项改变之后触发命令；</td></tr>
	</table>
	<ul>
		<li><p class="item">BufWinEnter<br />创建窗口之后触发命令；</p></li>
		<li><p class="item">BufEnter<br />进入缓冲区时触发命令；</p></li>
		<li><p class="item">VimEnter<br />Vim启动并载入初始化文件之后触发命令；</p></li>
		<li><p class="item">BufNew<br />创建缓冲区之后触发命令；</p></li>
		<li><p class="item">BufAdd<br />将缓冲区加入缓冲区列表之后触发命令；</p></li>
		<li><p class="item">BufLeave<br />离开缓冲区时触发命令；</p></li>
		<li><p class="item">BufWinLeave<br />从窗口中关闭缓冲区之前触发命令；</p></li>
		<li><p class="item">BufUnload<br />卸载缓冲区之前触发命令；</p></li>
		<li><p class="item">BufDelete<br />删除缓冲区之前触发命令；</p></li>
		<li><p class="item">BufReadCmd<br />开始编辑缓冲区之前触发命令；</p></li>
		<li><p class="item">InsertEnter<br />进入插入模式时触发命令；</p></li>
		<li><p class="item">InsertLeave<br />离开插入模式时触发命令；</p></li>
		<li><p class="item">BufWriteCmd<br />将缓冲区写入文件之前触发命令；</p></li>

		<li><p class="item">BufNewFile<br />当编辑一个新文件时触发命令；</p></li>
		<li><p class="item">BufReadPre<br />在读入新缓冲区之前触发命令；</p></li>
		<li><p class="item">BufRead, BufReadPost<br />在读入新缓冲区之后触发命令；</p></li>
		<li><p class="item">BufWrite, BufWritePre<br />在将缓冲区写入文件之前触发命令；</p></li>
		<li><p class="item">BufWritePost<br />在将缓冲区写入文件之后触发命令；</p></li>
		<li><p class="item">BufCreate<br />创建缓冲区以后触发命令；</p></li>
		<li><p class="item">FileReadPre<br />在使用:read命令读入文件之前触发命令；</p></li>
		<li><p class="item">FileReadPost<br />在使用:read命令读入文件之后触发命令；</p></li>
		<li><p class="item">FileChangedShell<br />当文件的最后修改时间、属性或尺寸发生改变时触发命令；</p></li>
		<li><p class="item">FileType<br />设置FileType之后触发命令；</p></li>
		<li><p class="item">Syntax<br />设置Syntax之后触发命令；</p></li>
		<li><p class="item">GUIEnter<br />启动GUI之后触发命令；</p></li>
		<li><p class="item">VimLeavePre<br />改写.viminfo文件之前，退出Vim之前触发命令；</p></li>
		<li><p class="item">VimLeave<br />改写.viminfo文件之后，退出Vim之前触发命令；</p></li>
		<li><p class="item">FocusGained<br />Vim成为当前窗口时触发命令；</p></li>
		<li><p class="item">FocusLost<br />Vim不再是当前窗口时触发命令；</p></li>
		<li><p class="item">vimResized<br />窗口尺寸变化之后触发命令；</p></li>
		<li><p class="item">WinEnter<br />进入窗口时触发命令；</p></li>
		<li><p class="item">WinLeave<br />离开窗口时触发命令；</p></li>
		<li><p class="item">CursorMoved<br />在常规模式下移动光标时触发命令；</p></li>
		<li><p class="item">CursorMovedI<br />在插入模式下移动光标时触发命令；</p></li>
		<li><p class="item">CursorHold<br />当超过'updatetime'所指定时间用户没有输入时触发命令；</p></li>
		<li><p class="item">StdinReadPre<br />由标准输入设备读入缓冲区之前触发命令；</p></li>
		<li><p class="item">StdinReadPost<br />由标准输入设备读入缓冲区之后触发命令；</p></li>
		<li><p class="item">EncodingChanged<br />'encoding'选项改变之后触发命令；</p></li>
	</ul>
	<p>Vim内置了近80个事件，您可以使用以下命令，获得详细的说明信息：</p>
	<p style="text-indent:2em"><code class="inset">:help autocommand-events</code></p>

:help :autocmd

当存文件时，只有下列事件成对出现时才引发:
BufWritePre    BufWritePost
FilterWritePre    FilterWritePost
FileAppendPre    FileAppendPost
FileWritePre    FileWritePost
当读文件进，只要下列事件中的一个被设置则会引发:
BufNewFile
BufReadPre    BufReadPost
FilterReadPre    FilterReadPost
FileReadPre    FileReadPost
	<p style="font-weight:bold">pattern参数</p>
	<p>利用匹配模式来指定应用自动命令的文件，可以使用以下特殊字符：</p>
	<table summary="Commands" border="1" frame="border" rules="all" cellspacing="0" cellpadding="3">
		<tr><td><code class="inset">*</code></td><td>匹配任意长度的任意字符</td></tr>
		<tr><td><code class="inset">?</code></td><td>匹配单个字符</td></tr>
		<tr><td><code class="inset">\?</code></td><td>匹配字符'?'</td></tr>
		<tr><td><code class="inset">.</code></td><td>匹配字符'.'</td></tr>
		<tr><td><code class="inset">,</code></td><td>用于分割多个pattern</td></tr>
		<tr><td><code class="inset">\,</code></td><td>匹配字符','</td></tr>
	</table>
	<p>您可以使用以下命令，获得详细的帮助信息：</p>
	<p style="text-indent:2em"><code class="inset">:help autocmd-patterns</code></p>

	<p style="font-weight:bold">nested参数</p>
	<p>通常一个命令的执行结果并不会引发另一个事件。例如Syntax的执行结果并不会引发FileReadPre事件。但是如果在自动命令中加入nested关键字，则可以触发，例如下面的命令：</p>
	<p style="text-indent:2em"><code class="inset">:autocmd FileChangedShell *.c nested e!</code></p>

	<h2 class="article"><a id="">查看自动命令</a></h2>
	<p>使用以下命令，可以列出所有自动命令：</p>
	<p style="text-indent:2em"><code class="inset">:autocmd</code></p>
	<p><a href="https://yyq123.github.io/learn-vim/images/autocmd.png" title="autocmd"><img src="https://yyq123.github.io/learn-vim/images/autocmd.png" alt="autocm" width="550" height="276" /></a></p>
	<p>你会发现自动命令的列表将会非常的长，其中既包括了在vimrc文件中用户定义的自动命令，也包括了各种插件定义的自动命令。</p>
	<p>在命令中如果指定了group，那么将会列出所有与指定group相匹配的自动命令；同理，也可以在命令中指定event和pattern，以查看相匹配的自动命令：</p>
	<p style="text-indent:2em"><code class="inset">:autocmd filetypedetect * *.htm</code></p>
	<p><a href="https://yyq123.github.io/learn-vim/images/autocmd_list.png" title="autocmd_list"><img src="https://yyq123.github.io/learn-vim/images/autocmd_list.png" alt="autocm_list" /></a></p>

	<h2 class="article"><a id="">删除自动命令</a></h2>
	<p>使用以下命令，可以删除所有自动命令：</p>
	<p style="text-indent:2em"><code class="inset">:autocmd!</code></p>
	<p>注意，此操作也将删除插件所定义的自动命令，请谨慎操作。</p>
	<p>使用以下命令，可以删除指定组的自动命令：</p>
	<p style="text-indent:2em"><code class="inset">:autocmd! group</code></p>
	<p>在命令中指定组、事件和匹配模式，可以删除特定的自动命令：</p>
	<p style="text-indent:2em"><code class="inset">autocmd! Unfocussed FocusLost *.txt</code></p>
	<p>在命令中使用特殊字符&ldquo;*&rdquo;来指代所有事件或文件。例如以下命令，将删除Unfocussed组中所有针对txt文件的自动命令：</p>
	<p style="text-indent:2em"><code class="inset">autocmd! Unfocussed * *.txt</code></p>
	<p>在命令中忽略文件匹配模式，那么所有针对指定事件的针对命令都将被删除。例如以下命令，将删除Unfocussed组在所有针对FocusLost事件的自动命令：</p>
	<p style="text-indent:2em"><code class="inset">autocmd! Unfocussed FocusLost</code></p>

	<h2 class="article"><a id="">自动命令选项</a></h2>
	<p>通过eventignore选项，可以忽略指定的事件，而不触发自动命令。例如使用以下命令，将忽略进入窗口和离开窗口的事件：</p>
	<p style="text-indent:2em"><code class="inset">:set eventignore=WinEnter,WinLeave</code></p>
	<p>如果希望忽略所有事件，那么可以使用以下设置：</p>
	<p style="text-indent:2em"><code class="inset">:set eventignore=all</code></p>

	<h2 class="article"><a id="">augroup</a></h2>
	<p>通过<code class="inset">:augroup</code>命令，可以将多个相关联的自动命令来分组管理。例如以下命令，将C语言开发的相关自动命令，组织在&ldquo;cprogram&rdquo;组内：</p>
<pre><code>
:augroup cprograms
:    autocmd!
:    autocmd FileReadPost *.c :set cindent
:    autocmd FileReadPost *.cpp :set cindent
:augroup END
</code></pre>
	<p>如果我们针对同样的文件和同样的事件定义了多条自动命令，那么当满足触发条件时将分别执行多条自动命令。因此，建议在自动命令组的开头增加:autocmd!命令，以确保没有重复的自动命令存在。</p>
	<p>您可以使用以下命令，获得详细的帮助信息：</p>
	<p style="text-indent:2em"><code class="inset">:help :augroup</code></p>


<h2 class="article"><a id="">启用/禁用</a></h2>
	<p></p>
	<a href="#" title=""></a>

	<p></p>
	<p style="text-indent:2em"><code class="inset"></code></p>

	<p><a href="https://yyq123.github.io/learn-vim/images/.png" title=""><img src="https://yyq123.github.io/learn-vim/images/.png" alt="" width="500" height="" /></a></p>
	<p style="color:gray; font-size:0.6em"><a href="http://yyq123.github.io/learn-vim/images/.png" title=""><img src="http://yyq123.github.io/learn-vim/images/.png" alt="" /></a></br>Source: medium.com/free-code-camp</p>

	<table summary="Commands" border="1" frame="border" rules="all" cellspacing="0" cellpadding="3">
		<caption style="margin:0.5em; font-weight:bold">选项列表</caption>
		<tr><th style="white-space: nowrap">选项</th><th>描述</th><th>帮助信息</th></tr>
		<tr><td><code class="inset">!</code></td><td>如果包含，表示。例如，。</td><td style="white-space: nowrap"><code class="inset">:help viminfo-!</code></td></tr>
	</table>

	<table summary="Commands" border="2" frame="hsides" rules="all" cellspacing="0" cellpadding="3">
		<caption>命令小结</caption>
		<tr><td><code class="inset">:</code></td><td rowspan="2"></td></tr>
		<tr><td><code class="inset">:</code></td></tr>
		<tr><td><code class="inset">:</code></td><td></td></tr>
		<tr><td><code class="inset">:</code></td><td></td></tr>
		<tr><td><code class="inset">:</code></td><td></td></tr>
	</table>
&ldquo;&rdquo;

	<p style="border-top:1px solid lightgray"><span style="float:right">Ver: 2.0&nbsp;|&nbsp;<a href="mailto:yyq123@gmail.com">YYQ</a></span><span>&lt;<a title="" href="http://yyq123.github.io/learn-vim/.html">上一篇</a>&nbsp;|<a title="笔记列表" href="http://yyq123.github.com/learn-vim/learn-vi-00-00-TOC.html">&nbsp;目录&nbsp;</a>|&nbsp;<a title="" href="http://yyq123.github.io/learn-vim/.html">下一篇</a>&gt;</span></p>
	<p></p>
	<p style="text-indent:2em"><code class="inset"></code></p>
	<p><a href="https://yyq123.github.io/learn-vim/images/.png" title=""><img src="https://yyq123.github.io/learn-vim/images/.png" alt="" width="500" height="" /></a></p>


	<table summary="Commands" border="2" frame="hsides" rules="all" cellspacing="0" cellpadding="3">
		<caption>命令小结</caption>
		<tr><td><code class="inset">:</code></td><td rowspan="2"></td></tr>
		<tr><td><code class="inset">:</code></td></tr>
		<tr><td><code class="inset">:</code></td><td></td></tr>
		<tr><td><code class="inset">:</code></td><td></td></tr>
		<tr><td><code class="inset">:</code></td><td></td></tr>
	</table>
&ldquo;&rdquo;

</body>
</html>

