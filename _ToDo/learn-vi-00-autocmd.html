<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="zh" xml:lang="zh">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<link rel="stylesheet" type="text/css" href="learn-vi.css" />
	<title>VIM学习笔记 自动命令(autocmd)</title>
</head>
<body>
	<h1>VIM学习笔记 自动命令(autocmd)</h1>

	<p>自动命令，就是可以在某些事件发生时自动执行的命令。例如可以通过自动命令来编辑压缩文件：即定义一个自动命令在读取文件时解压缩，在写入文件时再重新进行压缩。</p>
	<p>将自动命令与<a href="http://yyq123.github.io/learn-vim/learn-vi-93-ScriptUDF.html" title="Script-User Defined Function">函数</a>相结合，则可以完成更复杂的操作。比如自定义以下函数，用于在保存文件时插入当前日期：</p>
<pre><code>
:function DateInsert()
:    $read !date
:endfunction
</code></pre>
	<p>使用以下命令，可以手动调用函数：</p>
	<p style="text-indent:2em"><code class="inset">:call DateInsert()</code></p>
	<p>使用以下自动命令，则可以在保存文件时自动执行函数，以插入当前日期：</p>
	<p style="text-indent:2em"><code class="inset">:autocmd FileWritePre * :callDateInsert()<CR></code></p>
	<p>也就是说，vim将在保存文件之前执行指定的函数，然后再进行文件保存。</p>

	<h2 class="article"><a id="">autocmd</a></h2>
	<p>autocmd命令的一般格式如下：</p>
	<p style="text-indent:2em"><code class="inset">:autocmd [group] events pattern [nested] command</code></p>
	<ul>
		<li><p class="item">group<br />组名是可选项，用于分组管理多条自动命令；</p></li>
		<li><p class="item">events<br />事件参数，用于指明引发命令的一个或多个事件；</p></li>
		<li><p class="item">pattern<br />在符合匹配模式的文件中执行命令（*任意文件）；</p></li>
		<li><p class="item">nested<br />嵌套标记是可选项，用于允许嵌套自动命令；</p></li>
		<li><p class="item">command<br />指明需要执行的命令、函数或脚本；</p></li>
		<li><p class="item"><br />；</p></li>
		<li><p class="item"><br />；</p></li>
	</ul>

	<p style="font-weight:bold">events参数</p>
	<ul>

		<li><p class="item">BufNewFile<br />当编辑一个新文件时触发命令；</p></li>
		<li><p class="item">BufReadPre<br />在读入新缓冲区之前触发命令；</p></li>
		<li><p class="item">BufRead, BufReadPost<br />在读入新缓冲区之后触发命令；</p></li>
		<li><p class="item">BufWrite, BufWritePre<br />在将缓冲区写入文件之前触发命令；</p></li>
		<li><p class="item">BufWritePost<br />在将缓冲区写入文件之后触发命令；</p></li>
		<li><p class="item">BufEnter<br />进入缓冲区时触发命令；</p></li>
		<li><p class="item">BufLeave<br />离开缓冲区时触发命令；</p></li>
		<li><p class="item">BufCreate<br />创建缓冲区以后触发命令；</p></li>
		<li><p class="item">BufDelete<br />删除缓冲区之前触发命令；</p></li>
		<li><p class="item">FileReadPre<br />在使用:read命令读入文件之前触发命令；</p></li>
		<li><p class="item">FileReadPost<br />在使用:read命令读入文件之后触发命令；</p></li>
		<li><p class="item">FileChangedShell<br />当文件的最后修改时间、属性或尺寸发生改变时触发命令；</p></li>
		<li><p class="item">FileType<br />设置FileType之后触发命令；</p></li>
		<li><p class="item">Syntax<br />设置Syntax之后触发命令；</p></li>
		<li><p class="item">GUIEnter<br />启动GUI之后触发命令；</p></li>
		<li><p class="item">VimEnter<br />Vim启动并载入初始化文件之后触发命令；</p></li>
		<li><p class="item">VimLeave<br />改写.viminfo文件之后，退出Vim之前触发命令；</p></li>
		<li><p class="item">FocusGained<br />Vim成为当前窗口时触发命令；</p></li>
		<li><p class="item">FocusLost<br />Vim不再是当前窗口时触发命令；</p></li>
		<li><p class="item">vimResized<br />窗口尺寸变化之后触发命令；</p></li>
		<li><p class="item">WinEnter<br />进入窗口时触发命令；</p></li>
		<li><p class="item">WinLeave<br />离开窗口时触发命令；</p></li>
		<li><p class="item">CursorMoved<br />在常规模式下移动光标时触发命令；</p></li>
		<li><p class="item">CursorMovedI<br />在插入模式下移动光标时触发命令；</p></li>
		<li><p class="item">CursorHold<br />当超过'updatetime'所指定时间用户没有输入时触发命令；</p></li>
		<li><p class="item">StdinReadPre<br />由标准输入设备读入缓冲区之前触发命令；</p></li>
		<li><p class="item">StdinReadPost<br />由标准输入设备读入缓冲区之后触发命令；</p></li>
		<li><p class="item">EncodingChanged<br />'encoding'选项改变之后触发命令；</p></li>
		<li><p class="item">User<br />与:doautocmd命令组合使用的事件；</p></li>
		<li><p class="item"><br />触发命令；</p></li>
	</ul>
	<p>Vim内置了超过80个事件，您可以使用以下命令，获得详细的说明信息：</p>
	<p style="text-indent:2em"><code class="inset">:help autocommand-events</code></p>

:help :autocmd

当存文件时，只有下列事件成对出现时才引发:
BufWritePre    BufWritePost
FilterWritePre    FilterWritePost
FileAppendPre    FileAppendPost
FileWritePre    FileWritePost
当读文件进，只要下列事件中的一个被设置则会引发:
BufNewFile
BufReadPre    BufReadPost
FilterReadPre    FilterReadPost
FileReadPre    FileReadPost
	<p style="font-weight:bold">pattern参数</p>
	<p></p>
文件名类型与UNIX标准系统相匹配.下面列出是一些特殊字符匹配的情况:
*    匹配任意长度的任意字符
?    匹配单个字符
'    分隔交替的类型
\?   匹配字符?
.    匹配字符.
,    用于分割多个pattern
\,   匹配字符,
	<p>您可以使用以下命令，获得详细的帮助信息：</p>
	<p style="text-indent:2em"><code class="inset">:help autocmd-patterns</code></p>

	<p style="font-weight:bold">nested参数</p>
	<p>通常一个命令的执行结果并不会引发另一个事件。例如Syntax的执行结果并不会引发FileReadPre事件。但是如果在自动命令中加入nested关键字，则可以触发，例如下面的命令：</p>
	<p style="text-indent:2em"><code class="inset">:autocmd FileChangedShell *.c nested e!</code></p>

	<p>使用以下命令，可以列出所有自动命令：</p>
	<p style="text-indent:2em"><code class="inset">:autocmd</code></p>
:autocmd group event pattern
在这个命令中如果我们指定了group，那么就会所有与group相匹配的命令.event可以是以前定义的或是所有的事件，pattern指了与类型相匹配的文件选项.只有那些与命令相匹配的命令才会被列出来.
	<p>使用以下命令，可以删除所有自动命令：</p>
	<p style="text-indent:2em"><code class="inset">:autocmd!</code></p>
	<p>使用以下命令，可以删除指定组的自动命令：</p>
	<p style="text-indent:2em"><code class="inset">:autocmd! group</code></p>

在这个命令中我们当然也可以为这个组指定事件或是类型
:autocmd! group event pattern
event可以用*代替所有的事件
我们可以用命令:autocmd!来移除那些已经存在的自动命令，我们还可以同时在一个命令中再新建一个我们自己的自动命令.这个语法的格式如下:
:autocmd! group event pattern nested command
这个命令等价于下面的两个命令:
:autocmd! group event pattern
:autocmd group event pattern nested command

	<h2 class="article"><a id="">augroup</a></h2>
	<p>通过eventignore选项，可以忽略指定的事件，而不触发自动命令。例如使用以下命令，将忽略进入窗口和离开窗口的事件：</p>
	<p style="text-indent:2em"><code class="inset">:set eventignore=WinEnter,WinLeave</code></p>
	<p>如果希望忽略所有事件，那么可以使用以下设置：</p>
	<p style="text-indent:2em"><code class="inset">:set eventignore=all</code></p>

	<p>针对特定类型的文件，执行自动命令</p>
	<p>Vim会根据文件后缀名和文件内容来侦测文件类型，然后为其应用相应的<a href="http://yyq123.github.io/learn-vim/learn-vi-64-Syntax.html" title="Syntax">语法高亮度</a>和<a href="http://yyq123.github.io/learn-vim/learn-vi-66-Indent.html" title="Indent">缩进规则</a>。</p>
	<p>如果希望将特定文件后缀与已有的文件类型相关联，那么可以在<a href="http://yyq123.github.io/learn-vim/learn-vi-59-vimrc.html" title="vimrc">vimrc</a>配置文件中，使用以下自动命令进行设置：</p>
	<p style="text-indent:2em"><code class="inset">autocmd BufRead,BufNewFile *.foo set filetype=html</code></p>
For more info, try :help new-filetype in your Vim
<p>针对不同的文件类型，设置不同的属性：</p>
	<p style="text-indent:2em"><code class="inset">autocmd BufRead,BufNewFile *.html set shiftwidth=2</code></p>


	<h2 class="article"><a id="">augroup</a></h2>
	<p>通过<code class="inset">:augroup</code>命令，可以将多个相关联的自动命令来分组管理。例如以下命令，将C语言开发的相关自动命令，组织在&ldquo;cprogram&rdquo;组内：</p>
<pre><code>
:augroup cprograms
:    autocmd FileReadPost *.c :set cindent
:    autocmd FileReadPost *.cpp :set cindent
:augroup END
</code></pre>

<p>如果我们正在编辑的文件名为sam.cx，而我们想将他当作C程序文件来对处理.这时我们可以通过命令来告诉Vim编辑器在文件读入以后将他与*.c文件相匹配.我们所用的命令如下:</p>
:doautocmd group event file_name
在这个命令执行的时候，Vim是将假定当前文件的名字为file_name，而实际上这并不是他真正的文件名.如果在这个命令中我们并没有指明组(group)，那么所有的组都会被用到.而且我们必须指明事件，并且Vim会认为这个事件已经发生.与命令:doautocmd相类似的是命令:doautoall，所不同的只是后者是针对每一个缓冲区(buffer).这个命令的格式为:
:doautoall group event file_name
<h2 class="article"><a id="">启用/禁用</a></h2>
	<p></p>
	<a href="#" title=""></a>
:help :augroup
	<p style="font-weight:bold; border-bottom:1px solid lightgray; border-left:6px solid lightgray; padding:0 0 3px 5px">识别文件</p>
	<p></p>
	<p style="text-indent:2em"><code class="inset"></code></p>

	<p><a href="https://yyq123.github.io/learn-vim/images/.png" title=""><img src="https://yyq123.github.io/learn-vim/images/.png" alt="" width="500" height="" /></a></p>
	<p style="color:gray; font-size:0.6em"><a href="http://yyq123.github.io/learn-vim/images/.png" title=""><img src="http://yyq123.github.io/learn-vim/images/.png" alt="" /></a></br>Source: medium.com/free-code-camp</p>

	<table summary="Commands" border="1" frame="border" rules="all" cellspacing="0" cellpadding="3">
		<caption style="margin:0.5em; font-weight:bold">选项列表</caption>
		<tr><th style="white-space: nowrap">选项</th><th>描述</th><th>帮助信息</th></tr>
		<tr><td><code class="inset">!</code></td><td>如果包含，表示。例如，。</td><td style="white-space: nowrap"><code class="inset">:help viminfo-!</code></td></tr>
	</table>

	<table summary="Commands" border="2" frame="hsides" rules="all" cellspacing="0" cellpadding="3">
		<caption>命令小结</caption>
		<tr><td><code class="inset">:</code></td><td rowspan="2"></td></tr>
		<tr><td><code class="inset">:</code></td></tr>
		<tr><td><code class="inset">:</code></td><td></td></tr>
		<tr><td><code class="inset">:</code></td><td></td></tr>
		<tr><td><code class="inset">:</code></td><td></td></tr>
	</table>
&ldquo;&rdquo;

	<p style="border-top:1px solid lightgray"><span style="float:right">Ver: 2.0&nbsp;|&nbsp;<a href="mailto:yyq123@gmail.com">YYQ</a></span><span>&lt;<a title="" href="http://yyq123.github.io/learn-vim/.html">上一篇</a>&nbsp;|<a title="笔记列表" href="http://yyq123.github.com/learn-vim/learn-vi-00-00-TOC.html">&nbsp;目录&nbsp;</a>|&nbsp;<a title="" href="http://yyq123.github.io/learn-vim/.html">下一篇</a>&gt;</span></p>
	<p></p>
	<p style="text-indent:2em"><code class="inset"></code></p>
	<p><a href="https://yyq123.github.io/learn-vim/images/.png" title=""><img src="https://yyq123.github.io/learn-vim/images/.png" alt="" width="500" height="" /></a></p>


	<table summary="Commands" border="2" frame="hsides" rules="all" cellspacing="0" cellpadding="3">
		<caption>命令小结</caption>
		<tr><td><code class="inset">:</code></td><td rowspan="2"></td></tr>
		<tr><td><code class="inset">:</code></td></tr>
		<tr><td><code class="inset">:</code></td><td></td></tr>
		<tr><td><code class="inset">:</code></td><td></td></tr>
		<tr><td><code class="inset">:</code></td><td></td></tr>
	</table>
&ldquo;&rdquo;
</body>
</html>

