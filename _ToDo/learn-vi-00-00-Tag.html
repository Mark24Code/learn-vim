<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="zh" xml:lang="zh">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<link rel="stylesheet" type="text/css" href="learn-vi.css" />
	<title>VIM学习笔记 匹配多个标签(Matching Multiple Tags)</title>
</head>
<body>
	<h1>VIM学习笔记 匹配多个标签(Matching Multiple Tags)</h1>

	<p><a href="http://yyq123.github.io/learn-vim/learn-vi-79-01-Tag-File.html" title="Generates Tags File">上节</a>介绍了如何使用Ctag工具来生成标签文件（Tags File）。本节将介绍基于标签文件，快速在标签之间进行跳转的操作。</p>
	<p>标签是出现在标签文件（Tags File）中的一个标识符。它是一种能够跳转的标记。例如，在 C 程序里，每个函数名都可以是一个标签。</p>

	<h2 class="article"><a id=""></a></h2>
	<p style="text-indent:2em"><code class="inset"></code></p>

	<h2 class="article"><a id="tag-commands">标签跳转（Tag Navigation）</a></h2>
	<p>使用以下命令，可以直接跳转至定义标签的位置：</p>
	<p style="text-indent:2em"><code class="inset">:tag {<var>name</var>}</code></p>
	<p>在常规模式下，使用<kbd>Ctrl-]</kbd>快捷键，也可以查找光标下的标签（比如函数或宏等），并跳转到定义该标签的位置。</p>
	<p>在常规模式和插入模式下，按住<kbd>Ctrl</kbd>键并点击鼠标左键（<kbd>&lt;C-LeftMouse&gt;</kbd>），也可以跳转至标签定义处。</p>
	<p>使用以下命令，可以在新建窗口中跳转到定义标签的位置：</p>
	<p style="text-indent:2em"><code class="inset">:stag {<var>name</var>}</code></p>
	<p>在常规模式下，使用<kbd>Ctrl-W]</kbd>快捷键，也可以在新建窗口中跳转到定义标签的位置。</p>

	<h2 class="article"><a id="tag-regexp">标签搜索（Tag Search Pattern）</a></h2>
	<p>我们可以在文件的任意位置上执行<code class="inset">:tag</code>和<code class="inset">:tjump</code>命令，以跳转至指定的匹配处。而省去了将光标移动至标签之上，然后再点击快捷键的操作。</p>
	<p>如果启用了<a href="http://yyq123.github.io/learn-vim/learn-vi-46-02-wildmenu.html" title="wildmenu">wildmenu</a>选项，那么在输入命令时，我们只需要输入标签的开头几个字母，然后点击<kbd>Tab</kbd>键即可以自动补全标签名。</p>
<p>在命令中可以使用<a href="http://yyq123.github.io/learn-vi-81-RegularExpressionBasic.html" title="Regular Expression Basic">正则表达式</a>。例如<code class="inset">:tag /^HTML*</code>命令，将查找所有以&ldquo;HTML&rdquo;开头的标签，并跳转至第一个匹配项。</p>
	<p><a href="https://yyq123.github.io/learn-vim/images/tag_tab_wildmenu.png" title="tag_tab_wildmenu"><img src="https://yyq123.github.io/learn-vim/images/tag_tab_wildmenu.png" alt="tag_tab_wildmenu" /></a></p>
	<p>而<code class="inset">:tjump /^Color*</code>命令，将会显示所有以&ldquo;Color&rdquo;开头的标签，你可以选择跳转至某一匹配项。</p>
	<p><a href="https://yyq123.github.io/learn-vim/images/tjump_regex.png" title="tjump_regex"><img src="https://yyq123.github.io/learn-vim/images/tjump_regex.png" alt="tjump_regex" /></a></p>

	<h2 class="article"><a id="tag-matchlist">标签匹配列表（Tag Match List）</a></h2>
	<p>如果有多个匹配项存在，比如在几个文件中都定义了同名的函数，那么默认情况下，将优先跳转至当前文件中的匹配项。</p>
	<p>您可以使用<code class="inset">:h tag-priority</code>命令，查看优先级的帮助信息。
	<p>使用以下命令，将在屏幕底部显示标签匹配列表，然后根据您的选择在当前窗口中显示标签定义：</p>
	<p style="text-indent:2em"><code class="inset">:tselect <var>[tagname]</var></code></p>
	</p>使用<kbd>g]</kbd>快捷键，将显示与光标下标签匹配的列表：</p>
	<p><a href="https://yyq123.github.io/learn-vim/images/g-ctrl-].png" title="g-ctrl-]"><img src="https://yyq123.github.io/learn-vim/images/g-ctrl-].png" alt="g-ctrl-]" width="500" height="" /></a></p>
	<p>使用以下命令，将在屏幕底部显示标签匹配列表，然后根据您的选择在新建窗口中显示标签定义：</p>
	<p style="text-indent:2em"><code class="inset">:stselect <var>[tagname]</var></code></p>
	<p>在常规模式下，使用<kbd>Ctrl-Wg]</kbd>快捷键，将针对光标下的标签执行:tselect命令。</p>
	<p>使用以下命令，可以根据匹配列表中的顺序进行跳转，并在屏幕底部显示相对位置：</p>
	<p style="text-indent:2em"><code class="msg">tag 1 of n or more</code></p>
	<table summary="Commands" border="2" frame="hsides" rules="all" cellspacing="0" cellpadding="3">
		<caption></caption>
		<tr><th>缩写</th><th>命令</th><th>功能</th></tr>
		<tr><td><code class="inset">:ts</code></td><td><code class="inset">:tselect</code></td><td>显示标签匹配列表</td></tr>
		<tr><td><code class="inset">:tn</code></td><td><code class="inset">:tnext</code></td><td>跳转至下一个匹配项</td></tr>
		<tr><td><code class="inset">:tp</code></td><td><code class="inset">:tprevious</code></td><td>跳转至上一个匹配项</td></tr>
		<tr><td><code class="inset">:tf</code></td><td><code class="inset">:tfirst</code></td><td>跳转至第一个匹配项</td></tr>
		<tr><td><code class="inset">:tl</code></td><td><code class="inset">:tlast</code></td><td>跳转至最后一个匹配项</td></tr>
		<tr><td><code class="inset">:</code></td><td><code class="inset">:</code></td><td></td></tr>
	</table>

	<h2 class="article"><a id="tag-stack">标签栈（Tag Stack）</a></h2>
	<p>根据'tagstack'选项的默认设置，Vim会在标签栈中记录你跳转过的标签，以及是从哪里跳转到这些标签。</p>
	<p>使用以下命令，可以查看标签栈的内容：</p>
	<p style="text-indent:2em"><code class="inset">:tags</code></p>
	<p><a href="https://yyq123.github.io/learn-vim/images/tags.png" title=":tags"><img src="https://yyq123.github.io/learn-vim/images/tags.png" alt=":tags" width="550" height="141" /></a></p>
	<p>使用以下不带任何参数的命令，可以跳转到较新的标签处：</p>
	<p style="text-indent:2em"><code class="inset">:tag</code></p>
	<p>使用以下命令，可以返回到之前的标签处：</p>
	<p style="text-indent:2em"><code class="inset">:pop</code></p>
	<p>在常规模式下，使用使用<kbd>Ctrl-T</kbd>键，可以依次返回之前所处的位置。</p>
	<p>在常规模式和插入模式下，按住<kbd>Ctrl</kbd>键并点击鼠标右键（<kbd>&lt;C-RightMouse&gt;</kbd>），也可以返回之前所处的位置。</p>
	<p>如下图所示，首先使用:tag命令跳转至指定的标签，然后使用:pop命令返回到之前的位置。请留意屏幕底部输入的命令，以及白色高亮行的跳转过程：</p>
	<p><a href="https://yyq123.github.io/learn-vim/images/tag-stack-550.gif" title="tag-stack-550"><img src="https://yyq123.github.io/learn-vim/images/tag-stack-550.gif" alt="tag-stack-550" /></a></p>
	<p>使用<code class="inset">:h tag-stack</code>命令，可以查看标签栈的帮助信息。</p>
 

<p>通过安装<a href="http://www.vim.org/scripts/script.php?script_id=1590" title="unimpaired.vim">unimpaired.vim</a>插件，可以映射快捷键 <code class="highlighter-rouge">]t</code> for <code class="highlighter-rouge">:tnext</code> and <code class="highlighter-rouge">[t</code> for <code class="highlighter-rouge">:tprev.</code></p>


	<h2 class="article"><a id="tag-preview">预览窗口（Preview Window）</a></h2>
	<p>当我们使用<kbd>Ctrl-]</kbd>键跳转至函数定义处时，当前屏幕将会显示函数定义的代码，稍后我们仍需退回到之前的位置继续程序编辑。如果我们希望在编辑当前代码段的同时参考具体的函数定义，那么可以使用预览窗口（Preview Window）。</p>
	<p>请注意，为了使用预览窗口，Vim必须包含<a href="https://yyq123.github.io/learn-vim/learn-vi-70-01-QuickFix.html" title="QuickFix">QuickFix</a>特性。</p>
	<p>使用以下命令，将在屏幕上方的Preview窗口中显示指定标签名的内容，而不会改变当前光标的位置：</p>
	<p style="text-indent:2em"><code class="inset">:ptag <var>[tagname]</var></code></p>
	<p>使用<kbd>Ctrl-W}</kbd>快捷键，也可以针对当前光标下的标签执行:ptag命令：</p>
	<p>如果当前已经存在一个Preview窗口，那么将重用此窗口。</p>
	<p>如果希望，请使用以下命令：</p>
	<p style="text-indent:2em"><code class="inset">:</code></p>
	<p>您也可以使用<kbd></kbd>快捷键，来关闭Preview窗口。</p>

	<p>在preview窗口中我们执行下面的命令来完成我们的工作:</p>
	<table summary="Commands" border="2" frame="hsides" rules="all" cellspacing="0" cellpadding="3">
		<caption></caption>
		<tr><th>缩写</th><th>命令</th><th>功能</th></tr>
		<tr><td><code class="inset">:pts</code></td><td><code class="inset">:ptselect</code></td><td>执行:tselect命令并在预览窗口中显示标签</td></tr>
		<tr><td><code class="inset">:ptj</code></td><td><code class="inset">:ptjump</code></td><td><kbd>Ctrl-Wg}</kbd></td><td>执行:tjump命令并在预览窗口中显示标签</td></tr>
		<tr><td><code class="inset">:ptn</code></td><td><code class="inset">:ptnext</code></td><td>在预览窗口中执行:tnext命令</td></tr>
		<tr><td><code class="inset">:ptp</code></td><td><code class="inset">:ptprevious</code></td><td>在预览窗口中执行:tprevious命令</td></tr>
		<tr><td><code class="inset">:ptf</code></td><td><code class="inset">:ptfirst</code></td><td>在预览窗口中执行:tfirst命令</td></tr>
		<tr><td><code class="inset">:ptl</code></td><td><code class="inset">:ptlast</code></td><td>在预览窗口中执行:tlast命令</td></tr>
		<tr><td><code class="inset">:pp</code></td><td><code class="inset">:ppop</code></td><td>在预览窗口中执行个:pop命令</td></tr>
		<tr><td><code class="inset">:pc</code></td><td><code class="inset">:pclose</code></td><td><kbd>Ctrl-Wz</kbd></td><td>关闭Preview窗口</td></tr>
		<tr><td><code class="inset">:</code></td><td><code class="inset">:</code></td><td></td></tr>
	</table>	

	<h2 class="article"><a id="tag-preview">快速修复（Quickfix）</a></h2>
	<p>使用以下命令，</p>
	<p style="text-indent:2em"><code class="inset">:ltag [<var>name</var>]</code></p>
	跳转到标签 [name] 上并在当前窗口的新位置列表中加入匹配的标签。
	<p>使用以下命令，可以打开快速修复（Quickfix）窗口：</p>
	<p style="text-indent:2em"><code class="inset">:lopen</code></p>
	<p><a href="https://yyq123.github.io/learn-vim/images/ltag.png" title="ltag"><img src="https://yyq123.github.io/learn-vim/images/ltag.png" alt="ltag" width="550" height="183" /></a></p>
	<p>关于快速修复的使用，请参阅<a href="https://yyq123.github.io/learn-vim/learn-vi-70-01-QuickFix.html" title="QuickFix">QuickFix</a>章节。</p>

	<h2 class="article"><a id=""></a></h2>
	<p>看了那么多命令，是不是有些心烦意乱了？比较理想的状况应该是：如果只有只有一个匹配标签，那么直接跳转；如果发现多个匹配标签，则显示匹配列表。</p>
	<p>使用<code class="inset">:tjump <var>name</var></code>命令，如果只发现一个匹配标签，将直接跳转至标签定义处；如果发现多个匹配标签，那么将显示标签匹配列表。</p>
	<p>在常规模式下，使用<kbd>gCtrl-]</kbd>快捷键，将针对光标下的标签执行:tjupm命令。</p>
	<p>使用<code class="inset">:stjump</code>命令，则可以在新建窗口中执行:tjupm命令。</p>
	<p>在常规模式下，使用<kbd>Ctrl-W g Ctrl-]</kbd>快捷键，将针对光标下的标签在新建窗口中执行:tjupm命令。</p>
	<p></p>
	<p style="text-indent:2em"><code class="inset"></code></p>


	<table summary="Commands" border="2" frame="hsides" rules="all" cellspacing="0" cellpadding="3">
		<caption>命令小结</caption>
		<tr><td><code class="inset">:</code></td><td rowspan="2"></td></tr>
		<tr><td><code class="inset">:</code></td></tr>
		<tr><td><code class="inset">:</code></td><td></td></tr>
		<tr><td><code class="inset">:</code></td><td></td></tr>
		<tr><td><code class="inset">:</code></td><td></td></tr>
	</table>
&ldquo;&rdquo;

	<p style="border-top:1px solid lightgray"><span style="float:right">Ver: 2.0&nbsp;|&nbsp;<a href="mailto:yyq123@gmail.com">YYQ</a></span><span>&lt;<a title="生成标签文件(Generates Tags File)" href="http://yyq123.github.io/learn-vim/learn-vi-79-01-Tag-File.html.html">上一篇</a>&nbsp;|<a title="笔记列表" href="http://yyq123.github.com/learn-vim/learn-vi-00-00-TOC.html">&nbsp;目录&nbsp;</a>|&nbsp;<a title="" href="http://yyq123.github.io/learn-vim/.html">下一篇</a>&gt;</span></p>

</body>
</html>
