<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="zh" xml:lang="zh">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<link rel="stylesheet" type="text/css" href="learn-vi.css" />
	<title>VIM学习笔记 Ex模式 (Ex Mode)</title>
</head>
<body>
	<h1>VIM学习笔记 Ex模式 (Ex Mode)</h1>
	<p>很久很久以前，人们还是使用打印设备而非显示器来与计算机进行沟通。比如打印出某行代码以确定需要修改的内容，然后针对文本进行操作，再次打印以检查变更效果。在此情形之下，行号就成为有效的定位工具。虽然，今天我们已经不再如此依赖打印设备，但是基于行编辑的Ex模式，在操作文本时还是有某些优势的。比如将文本从一个文件移动到另一个文件；快速地对大于单个屏幕的文本块进行编辑；针对整个文件中的特定模式进行全局替换等等。</p>
	<p>甚至可以说，Vim是Ex行编辑器的可视模式。或者说，Ex是Vi的底层行编辑器。</p>
	
	<p style="font-weight:bold; border-bottom:1px solid lightgray; border-left:6px solid lightgray; padding:0 0 3px 5px">进入Ex模式</p>
	<p>在操作系统的命令行中，使用以下Ex命令，可以进入Vim的Ex模式：</p>
	<p style="text-indent:2em"><code class="inset">$ ex filename</code></p>
	<p><a href="https://yyq123.github.io/learn-vim/images/ExMode.png" title="ExMode"><img src="https://yyq123.github.io/learn-vim/images/ExMode.png" alt="ExMode" /></a></p>
	<p>在Vim的常规模式下，使用<code class="inset">Q</code>或者<code class="inset">gQ</code>命令，可以进入Vim的Ex模式：</p>
	<p><a href="https://yyq123.github.io/learn-vim/images/ExMode_FromNormalMode.png" title="ExMode_FromNormalMode"><img src="https://yyq123.github.io/learn-vim/images/ExMode_FromNormalMode.png" alt="ExMode_FromNormalMode" width="500" height="40" /></a></p>

	<p style="font-weight:bold; border-bottom:1px solid lightgray; border-left:6px solid lightgray; padding:0 0 3px 5px">执行Ex命令</p>
	<p>ex命令由行地址和命令组成，并以回车键结束。</p>
	<p>如果我们在命令中没有指定行号，那么命令将默认作用于当前行。例如以下命令将在当前行中，将第一个"Hello"替换为"Hi"：</p>
	<p style="text-indent:2em"><code class="inset">:s/Hello/Hi</code></p>
	<p>请注意，在命令执行之后，受到影响的当前行，将会被重新打印到屏幕上：</p>
	<p><a href="https://yyq123.github.io/learn-vim/images/ExMode_ChangeCurrentLine.png" title="ExMode_ChangeCurrentLine"><img src="https://yyq123.github.io/learn-vim/images/ExMode_ChangeCurrentLine.png" alt="ExMode_ChangeCurrentLine" /></a></p>
	<p>如果我们在命令中指定了行号，那么命令将作用于指定的行范围。例如以下命令将在多行中，将所有"Hello"替换为"Hi"：</p>
	<p style="text-indent:2em"><code class="inset">:1,6s/Hello/Hi</code></p>
	<p>请注意，在命令执行之后，受到影响的行信息，将会被重新打印到屏幕上：</p>
	<p><a href="https://yyq123.github.io/learn-vim/images/ExMode_ChangeMultiLine.png" title="ExMode_ChangeMultiLine"><img src="https://yyq123.github.io/learn-vim/images/ExMode_ChangeMultiLine.png" alt="ExMode_ChangeMultiLine" /></a></p>
	<p>在命令中可以使用以下三种方式，来指定行地址：</p>
	<ul>
		<li>显式指定行号的绝对地址；</li>
		<li>使用特殊符号，指定相对地址；</li>
		<li>由搜索模式指定的地址。</li>
	</ul>
	<p style="font-weight:bold">指定行号的绝对地址</p>
	<p>使用以下命令，可以打印当前文件的第二行内容（到屏幕）：</p>
	<p style="text-indent:2em"><code class="inset">:2p</code></p>
	<p>通过在命令中指定行号范围，可以显示多行内容：</p>
	<p style="text-indent:2em"><code class="inset">:2,10p</code></p>
	<p>使用以下命令，可以将11至15行移动到23行下面：</p>
	<p style="text-indent:2em"><code class="inset">:11,15m23</code></p>
	<p>使用以下命令，可以复制23至29行并粘贴到100行下面：</p>
	<p style="text-indent:2em"><code class="inset">:23,29co100</code></p>

	<p style="font-weight:bold">特殊符合指定的相对地址</p>
	<p>在指定行地址时，可以使用特殊符号：点&ldquo;<code class="inset">.</code>&rdquo;代表当前行；美元符合&ldquo;<code class="inset">$</code>&rdquo;代表文件的最后一行；百分号&ldquo;<code class="inset">%</code>&rdquo;代表文件的每一行，等同于1,$的组合。特殊符号可以与行号组合使用，例如：</p>
	<p>使用以下命令，可以删除最后一行：</p>
	<p style="text-indent:2em"><code class="inset">:$d</code></p>
	<p>使用以下命令，可以删除从当前行到文件末尾：</p>
	<p style="text-indent:2em"><code class="inset">:.,$d</code></p>
	<p>使用以下命令，可以删除文件中的所有行：</p>
	<p style="text-indent:2em"><code class="inset">:1,$d</code></p>
	<p style="text-indent:2em"><code class="inset">:%d</code></p>
	<p>使用以下命令，可以把20至当前行的文本移动到文件末尾：</p>
	<p style="text-indent:2em"><code class="inset">:20,.m$</code></p>
	<p>使用以下命令，可以复制所有行并粘贴到文件的尾部：</p>
	<p style="text-indent:2em"><code class="inset">:%t$</code></p>
	<p>当符号&ldquo;+&rdquo;和&ldquo;-&rdquo;放置在数字前面时，就会像数学运算符一样，表示加上或减去指定的行数。例如：</p>
	<p>使用以下命令，可以删除当前行之前的所有行：</p>
	<p style="text-indent:2em"><code class="inset">:1,.-1d</code></p>
	<p>使用以下命令，可以删除从当前行到当前行以下20行：</p>
	<p style="text-indent:2em"><code class="inset">:.,.+20d</code></p>
	<p>使用以下命令，可以把226行到文件末尾的文本移动到当前行的上面两行的后面：</p>
	<p style="text-indent:2em"><code class="inset">:226,$m.-2</code></p>
	<p>事实上，由于当前行是假定的开始位置，因此在使用+或-时并不必需输入圆点符号；如果在+或-后面没有数字，那么就等价于+1和-1；数字0代表文件的开头（即0行）。</p>
	<p>使用以下命令，可以复制三行（当前行，前一行，后一行），并粘贴到文件开头。例如：</p>
	<p style="text-indent:2em"><code class="inset">:-,+t0</code></p>

	<p style="font-weight:bold">搜索模式指定的相对地址</p>
	<p>使用以下命令，可以删除下一个包含模式pattern的行：</p>
	<p style="text-indent:2em"><code class="inset">:/pattern/d</code></p>
	<p>使用以下命令，可以删除下一个包含模式pattern的行的下一行：</p>
	<p style="text-indent:2em"><code class="inset">:/pattern/+d</code></p>
	<p>使用以下命令，可以删除第一个包含pattern1的行与第一个包含pattern2的行之间的所有行：</p>
	<p style="text-indent:2em"><code class="inset">:/pattern1/,/pattern2/d</code></p>
	<p>使用以下命令，可以从当前行到第一个包含pattern的行之间的文本移动到23行后面：</p>
	<p style="text-indent:2em"><code class="inset">:.,/pattern/m23</code></p>

	<p style="font-weight:bold">重新定义当前行的位置</p>
	<p>假设当前光标在第一行。</p>
	<p style="text-indent:2em"><code class="inset">:100,+5p</code></p>
	<p>执行以上命令，系统反馈信息认为终止行范围小于起始行范围：</p>
	<p style="text-indent:2em"><code class="msg">Backwards range given, OK to swap (y/n)</code></p>
	<p>如果输入y，则意味着交换行范围的起止位置，即显示（1+5=）6至100行；如果输入n，则行范围（100至6行）无效，命令失败。</p>
	<p>在ex命令中，当使用分号&ldquo;;&rdquo;代替逗号&ldquo;,&rdquo;时，就会将第一个行地址视为“当前行”。</p>
	<p>不管当前光标处于文件的哪一行，以下命令都将视第100行为当前行，并显示当前行及之后5行（即100至105行）：</p>
	<p style="text-indent:2em"><code class="inset">:100;+5p</code></p>
	<p>分号也可以用于搜索模式的相对地址中。例如，显示下一个包含模式pattern的行以及之后的10行：</p>
	<p style="text-indent:2em"><code class="inset">:/patter/;+10p</code></p>

	<table summary="Commands" border="2" frame="hsides" rules="all" cellspacing="0" cellpadding="3">
		<caption>ex常用编辑命令</caption>
		<tr><th>命令</th><th>缩写</th><th>用途</th></tr>
		<tr><td><code class="inset">delete</code></td><td><code class="inset">d</code></td><td>删除行</td></tr>
		<tr><td><code class="inset">move</code></td><td><code class="inset">m</code></td><td>移动行</td></tr>
		<tr><td><code class="inset">copy</code></td><td><code class="inset">co</code></td><td>复制行</td></tr>
		<tr><td><code class="inset"></code></td><td><code class="inset">t</code></td><td>复制行，与co同义</td></tr>
	</table>

	<p><a href="https://yyq123.github.io/learn-vim/images/.png" title=""><img src="https://yyq123.github.io/learn-vim/images/.png" alt="" width="500" height="" /></a></p>

全局搜索

我们已经知道在vi中使用/(斜杆)来搜索文件中的字符模式。ex也有全局命令g， 可以让你搜索模式并显示找出的所有包含该模式的行。命令：g!的作用与：g相反，使用：g!（或它的同义词：v）可以搜索不包行该模式的行

可以对文件中的所有行使用全局命令，也可以使用行地址把全局搜索限定在指定的行或行范围内。


：g /pattern             寻找（移动到）模式pattern在文件中最后出现的位置
：g /pattern/ p         寻找并显示文件中所有包含模式pattern的行
：g!/pattern/nu       寻找并显示文件中所有不包行模式pattern的行，并显示这些行号  
：20, 40g/pattern/p  寻找并显示第20到40行之间所有包含模式pattern的行

	<p style="font-weight:bold; border-bottom:1px solid lightgray; border-left:6px solid lightgray; padding:0 0 3px 5px">组合Ex命令</p>
	<p>竖直线&ldquo;|&rdquo;作为命令分割符，可以将多个命令组合在一起执行。使用&ldquo;|&rdquo;时，如果前一个命令影响到文件中行的顺序，那么下一个命令将使用新的行位置进行工作。</p>
	<p>使用以下命令，将首先删除第1行至第3行，然后在当前行（即调用ex命令之前的第4行）进行替换：</p>
	<p style="text-indent:2em"><code class="inset">:1,3d | s/thier/their/</code></p>
	<p>使用以下命令，将首先把1至5行移动到第10行之后，然后显示所有包含模式pattern的行：</p>
	<p style="text-indent:2em"><code class="inset">:1,5m10 | g/pattern/nu</code></p>

	<p style="font-weight:bold; border-bottom:1px solid lightgray; border-left:6px solid lightgray; padding:0 0 3px 5px">退出Ex模式</p>
	<p>使用以下命令，可以退出Ex模式，并进入常规模式：</p>
	<p style="text-indent:2em"><code class="inset">:vi</code></p>
	<p>使用以下命令，可以退出Ex模式，并返回到操作系统的命令行提示符下：</p>
	<p style="text-indent:2em"><code class="inset">:q</code></p>

编辑多个文件
：e  filename
使用这个命令切换到新文件filename时，vi把之前的文件名记为#， 当前文件名记为%，使用这两个文件可以迅速切换
：e #  切换到上一个文件中
：r  #  把上一个文件的内容粘贴到当前文件中
：e! #  放弃当前文件编辑，并返回上一个文件中

：e #的快捷键：
由于切换到前面的文件会经常发生，因此不必在ex命令行下进行这种操作。
可以使用快捷键Ctrl + ^来使用，和：e #效果相同。

	<table summary="Commands" border="2" frame="hsides" rules="all" cellspacing="0" cellpadding="3">
		<caption>命令小结</caption>
		<tr><td><code class="inset">:</code></td><td rowspan="2"></td></tr>
		<tr><td><code class="inset">:</code></td></tr>
		<tr><td><code class="inset">:</code></td><td></td></tr>
		<tr><td><code class="inset">:</code></td><td></td></tr>
		<tr><td><code class="inset">:</code></td><td></td></tr>
	</table>
&ldquo;&rdquo;

	<p style="border-top:1px solid lightgray"><span style="float:right">Ver: 2.0&nbsp;|&nbsp;<a href="mailto:yyq123@gmail.com">YYQ</a></span><span>&lt;<a title="" href="http://yyq123.github.io/learn-vim/.html">上一篇</a>&nbsp;|<a title="笔记列表" href="http://yyq123.github.com/learn-vim/learn-vi-00-00-TOC.html">&nbsp;目录&nbsp;</a>|&nbsp;<a title="" href="http://yyq123.github.io/learn-vim/.html">下一篇</a>&gt;</span></p>

</body>
</html>
